<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoopsTracker | Dashboard Joueur</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- VARIABLES & RESET --- */
        :root {
            --bg-dark: #0f1115;
            --bg-card: #181b21;
            --bg-hover: #22262e;
            --primary: #ff9100; /* Orange Basket */
            --primary-dim: #ff910033;
            --secondary: #64748b; /* Slate Gray */
            --accent-blue: #3b82f6;
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --danger: #ef4444;
            --success: #10b981;
            
            --radius: 16px;
            --shadow: 0 4px 20px rgba(0,0,0,0.25);
            --font-main: 'Inter', sans-serif;
            --nav-width: 80px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- NAVIGATION --- */
        nav {
            width: var(--nav-width);
            height: 100vh;
            background-color: var(--bg-card);
            border-right: 1px solid #2d313a;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 0;
            z-index: 100;
        }

        .logo {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 3rem;
        }

        .nav-item {
            color: var(--text-muted);
            font-size: 1.4rem;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            width: 100%;
            text-align: center;
            padding: 10px 0;
        }

        .nav-item:hover, .nav-item.active {
            color: var(--primary);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 30px;
            width: 3px;
            background-color: var(--primary);
            border-radius: 4px 0 0 4px;
        }

        /* --- MAIN CONTENT --- */
        main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            position: relative;
        }

        header {
            margin-bottom: 2rem;
        }

        h1 { font-weight: 800; letter-spacing: -0.5px; }
        h2 { font-size: 1.2rem; margin-bottom: 1rem; color: var(--text-muted); font-weight: 600; }

        /* --- SECTIONS (TAB SYSTEM) --- */
        section { display: none; animation: fadeIn 0.4s ease; }
        section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- BENTO GRID SYSTEM --- */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(auto, minmax(150px, auto));
            gap: 1.5rem;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid transparent;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card:hover { border-color: #2d313a; transform: translateY(-2px); }

        /* Specific Card Sizes */
        .col-span-1 { grid-column: span 1; }
        .col-span-2 { grid-column: span 2; }
        .col-span-4 { grid-column: span 4; }
        .row-span-2 { grid-row: span 2; }

        /* --- DASHBOARD WIDGETS --- */
        .stat-value { font-size: 2.5rem; font-weight: 800; color: var(--text-main); }
        .stat-label { color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .icon-bg { 
            position: absolute; top: 1rem; right: 1rem; 
            font-size: 4rem; opacity: 0.05; color: var(--text-main); 
        }

        .streak-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .flame-icon { color: var(--primary); font-size: 2rem; filter: drop-shadow(0 0 8px var(--primary)); }
        
        /* --- FORMS --- */
        .form-container {
            background-color: var(--bg-card);
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; color: var(--text-muted); }
        
        input, select {
            width: 100%;
            padding: 1rem;
            background-color: var(--bg-dark);
            border: 1px solid #2d313a;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }
        
        input:focus, select:focus { border-color: var(--primary); }

        .btn-submit {
            width: 100%;
            padding: 1rem;
            background-color: var(--primary);
            color: #000;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 1rem;
        }
        .btn-submit:hover { background-color: #e68200; transform: scale(0.99); }
        
        .btn-add-exo {
            width: 100%;
            padding: 0.8rem;
            background-color: #2d313a;
            color: var(--text-muted);
            font-weight: 600;
            border: 1px dashed #4b5563;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            margin-bottom: 1.5rem;
        }
        .btn-add-exo:hover { background-color: #353a45; color: white; border-color: white; }

        .btn-type-toggle {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .toggle-opt {
            flex: 1;
            padding: 1rem;
            text-align: center;
            background: var(--bg-dark);
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid transparent;
        }
        .toggle-opt.selected { border-color: var(--primary); color: var(--primary); background: var(--primary-dim); }

        /* EXERCISE/DRILL LIST IN FORM */
        .exo-inputs { display: flex; gap: 10px; margin-bottom: 10px; }
        .exo-inputs input { padding: 0.8rem; }
        .added-exos-list { 
            list-style: none; 
            margin-bottom: 1.5rem; 
            border-top: 1px solid #2d313a;
            padding-top: 1rem;
        }
        .added-exo-item {
            display: flex;
            justify-content: space-between;
            background: var(--bg-dark);
            padding: 0.8rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .remove-exo { color: var(--danger); cursor: pointer; margin-left: 10px; }

        /* --- LIST & CALENDAR --- */
        .history-list { list-style: none; }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #2d313a;
            position: relative;
        }
        .history-item:last-child { border-bottom: none; }

        .btn-delete-session {
            color: var(--danger);
            opacity: 0.4;
            cursor: pointer;
            padding: 8px;
            transition: 0.2s;
            margin-left: 10px;
        }
        .btn-delete-session:hover { opacity: 1; transform: scale(1.1); }
        
        .tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .tag-basket { background: var(--primary-dim); color: var(--primary); }
        .tag-gym { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 1rem;
        }
        .cal-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-dark);
            border-radius: 8px;
            font-size: 0.8rem;
            position: relative;
        }
        .dot { width: 6px; height: 6px; border-radius: 50%; margin-top: 4px; }
        .dot-basket { background-color: var(--primary); }
        .dot-gym { background-color: var(--accent-blue); }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            nav { width: 100%; height: 60px; flex-direction: row; justify-content: space-around; padding: 0; position: fixed; bottom: 0; border-right: none; border-top: 1px solid #2d313a; }
            .nav-item { margin-bottom: 0; font-size: 1.2rem; }
            .nav-item.active::after { display: none; }
            .nav-item.active { color: var(--primary); }
            .logo { display: none; }
            main { padding: 1rem; margin-bottom: 60px; }
            .bento-grid { grid-template-columns: 1fr; }
            .col-span-1, .col-span-2, .col-span-4 { grid-column: span 1; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo"><i class="fas fa-basketball-ball"></i></div>
        <div class="nav-item active" onclick="app.navigate('dashboard')" title="Dashboard">
            <i class="fas fa-th-large"></i>
        </div>
        <div class="nav-item" onclick="app.navigate('add-session')" title="Ajouter Session">
            <i class="fas fa-plus-circle"></i>
        </div>
        <div class="nav-item" onclick="app.navigate('history')" title="Historique">
            <i class="fas fa-calendar-alt"></i>
        </div>
    </nav>

    <main>
        
        <section id="dashboard" class="active">
            <header>
                <h1>Tableau de Bord</h1>
                <p style="color:var(--text-muted)">Bienvenue, Pr√™t √† dominer le terrain ?</p>
            </header>

            <div class="bento-grid">
                <div class="card col-span-2">
                    <div class="stat-label">Current Streak</div>
                    <div class="streak-container">
                        <i class="fas fa-fire flame-icon"></i>
                        <div class="stat-value" id="streak-display">0 Jours</div>
                    </div>
                    <p style="color:var(--text-muted); font-size:0.9rem; margin-top:5px;">La r√©gularit√© est la cl√©.</p>
                </div>

                <div class="card col-span-1">
                    <i class="fas fa-dumbbell icon-bg"></i>
                    <div class="stat-label">Sessions Totales</div>
                    <div class="stat-value" id="total-sessions">0</div>
                </div>

                <div class="card col-span-1">
                    <i class="fas fa-bullseye icon-bg"></i>
                    <div class="stat-label">R√©ussite Tirs</div>
                    <div class="stat-value" id="avg-shooting">0%</div>
                </div>

                <div class="card col-span-4 row-span-2">
                    <div class="stat-label">Fr√©quence d'entra√Ænement (7 derniers jours)</div>
                    <div style="position: relative; height: 300px; width: 100%;">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>

                <div class="card col-span-2">
                    <div class="stat-label">Heures de Muscu</div>
                    <div class="stat-value" id="total-gym-hours">0h</div>
                </div>
            </div>
        </section>

        <section id="add-session">
            <header>
                <h1>Nouvelle S√©ance</h1>
            </header>

            <div class="form-container">
                <div class="btn-type-toggle">
                    <div class="toggle-opt selected" onclick="app.toggleForm('basket')" id="opt-basket">
                        <i class="fas fa-basketball-ball"></i> Basket
                    </div>
                    <div class="toggle-opt" onclick="app.toggleForm('gym')" id="opt-gym">
                        <i class="fas fa-dumbbell"></i> Muscu
                    </div>
                </div>

                <form id="form-basket" onsubmit="app.saveSession(event, 'basket')">
                    <div class="form-group">
                        <label>Type Principal</label>
                        <select id="basket-type">
                            <option value="Shooting">Shooting</option>
                            <option value="Dribble">Dribble / Skills</option>
                            <option value="Match">Match / Pick-up</option>
                            <option value="Collectif">Entra√Ænement Collectif</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dur√©e (minutes)</label>
                        <input type="number" id="basket-duration" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Sensation / Forme (1-10)</label>
                        <input type="number" id="basket-rating" min="1" max="10" required>
                    </div>

                     <div style="border-top: 1px solid #2d313a; margin-top: 1.5rem; padding-top: 1rem;">
                        <label style="color:var(--primary); margin-bottom: 10px;">D√©tails (Drills & Stats)</label>
                        <p style="font-size:0.8rem; color:var(--text-muted); margin-bottom:10px;">Entre ton score au format "8/10" ou "45/50" pour calculer ta r√©ussite.</p>
                        
                        <div class="exo-inputs">
                            <input type="text" id="drill-name" placeholder="Drill (ex: 3pts Corner)" style="flex:2">
                            <input type="text" id="drill-stat" placeholder="Score (ex: 7/10)" style="flex:1">
                        </div>
                        <button type="button" class="btn-add-exo" onclick="app.addDrillToSession()">
                            <i class="fas fa-plus"></i> Ajouter Drill
                        </button>

                        <ul class="added-exos-list" id="temp-drill-list">
                            </ul>
                    </div>

                    <button type="submit" class="btn-submit">Enregistrer Basket</button>
                </form>

                <form id="form-gym" style="display:none;" onsubmit="app.saveSession(event, 'gym')">
                    <div class="form-group">
                        <label>Focus (Ex: Haut du corps, Jambes)</label>
                        <input type="text" id="gym-focus" placeholder="Th√®me de la s√©ance" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Dur√©e Totale (minutes)</label>
                        <input type="number" id="gym-duration" min="1" required>
                    </div>

                    <div style="border-top: 1px solid #2d313a; margin-top: 1.5rem; padding-top: 1rem;">
                        <label style="color:var(--accent-blue); margin-bottom: 10px;">Ajouter des exercices</label>
                        
                        <div class="form-group">
                            <input type="text" id="ex-name" placeholder="Nom de l'exercice (ex: Bench Press)">
                        </div>
                        <div class="exo-inputs">
                            <input type="number" id="ex-sets" placeholder="S√©ries" style="flex:1">
                            <input type="number" id="ex-reps" placeholder="Reps" style="flex:1">
                            <input type="number" id="ex-weight" placeholder="Kg" style="flex:1">
                        </div>
                        <button type="button" class="btn-add-exo" onclick="app.addExerciseToSession()">
                            <i class="fas fa-plus"></i> Ajouter l'exercice
                        </button>

                        <ul class="added-exos-list" id="temp-exo-list">
                            </ul>
                    </div>

                    <button type="submit" class="btn-submit" style="background-color: var(--accent-blue); color:white;">Enregistrer S√©ance Muscu</button>
                </form>
            </div>
        </section>

        <section id="history">
            <header>
                <h1>Historique & Calendrier</h1>
            </header>

            <div class="bento-grid">
                <div class="card col-span-2 row-span-2">
                    <h2>Derni√®res S√©ances</h2>
                    <ul class="history-list" id="history-container">
                        <li style="text-align:center; color:var(--text-muted); padding:2rem;">Aucune donn√©e</li>
                    </ul>
                </div>

                <div class="card col-span-2 row-span-2">
                    <div style="display:flex; justify-content:space-between;">
                        <h2>Ce Mois-ci</h2>
                        <span style="font-size:0.8rem; color:var(--text-muted);">Orange: Basket | Bleu: Gym</span>
                    </div>
                    <div class="calendar-grid" id="calendar-grid">
                        </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        /**
         * DATA MANAGER: Handles LocalStorage and Data Processing
         */
        class DataManager {
            constructor() {
                this.storageKey = 'hoops_tracker_data_v1';
                this.data = this.load();
            }

            load() {
                const stored = localStorage.getItem(this.storageKey);
                return stored ? JSON.parse(stored) : [];
            }

            save(session) {
                this.data.unshift(session); // Add to beginning
                this.persist();
            }

            delete(id) {
                this.data = this.data.filter(s => s.id !== id);
                this.persist();
            }

            persist() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.data));
            }

            getAll() { return this.data; }

            // Statistics Logic
            getStats() {
                const totalSessions = this.data.length;
                
                // Gym Hours
                const gymSessions = this.data.filter(s => s.type === 'gym');
                const gymMinutes = gymSessions.reduce((acc, curr) => acc + parseInt(curr.duration), 0);
                
                // Shooting Average Calculation (REGEX Parsing)
                let totalMade = 0;
                let totalAttempted = 0;

                const basketSessions = this.data.filter(s => s.type === 'basket');
                
                basketSessions.forEach(session => {
                    if (session.details.drills && session.details.drills.length > 0) {
                        session.details.drills.forEach(drill => {
                            // Look for patterns like "8/10", "8 / 10", "45/50"
                            const match = drill.stat.match(/(\d+)\s*[\/]\s*(\d+)/);
                            if (match) {
                                const made = parseInt(match[1]);
                                const attempted = parseInt(match[2]);
                                if (attempted > 0) {
                                    totalMade += made;
                                    totalAttempted += attempted;
                                }
                            }
                        });
                    }
                });

                const shootingPct = totalAttempted > 0 
                    ? ((totalMade / totalAttempted) * 100).toFixed(1) 
                    : 0;

                return {
                    total: totalSessions,
                    gymHours: (gymMinutes / 60).toFixed(1),
                    avgShoot: shootingPct
                };
            }

            getStreak() {
                if (this.data.length === 0) return 0;
                
                // Get unique dates sorted descending
                const dates = [...new Set(this.data.map(s => s.date.split('T')[0]))].sort().reverse();
                
                let streak = 0;
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

                if (dates[0] !== today && dates[0] !== yesterday) return 0;

                let currentDate = new Date(dates[0]);
                streak++; 

                for (let i = 1; i < dates.length; i++) {
                    let prevDate = new Date(dates[i]);
                    let diffTime = Math.abs(currentDate - prevDate);
                    let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                    if (diffDays === 1) {
                        streak++;
                        currentDate = prevDate;
                    } else {
                        break;
                    }
                }
                return streak;
            }

            getLast7DaysActivity() {
                const counts = [0,0,0,0,0,0,0]; 
                const labels = [];
                const today = new Date();

                for(let i=6; i>=0; i--) {
                    const d = new Date(today);
                    d.setDate(d.getDate() - i);
                    const dateStr = d.toISOString().split('T')[0];
                    labels.push(d.toLocaleDateString('fr-FR', {weekday:'short'}));
                    
                    const dayCount = this.data.filter(s => s.date.split('T')[0] === dateStr).length;
                    counts[6-i] = dayCount;
                }
                return { labels, counts }; 
            }
        }

        /**
         * UI CONTROLLER: DOM Manipulation & Charts
         */
        class UI {
            constructor(dataManager) {
                this.dm = dataManager;
                this.chartInstance = null;
                
                this.renderDashboard();
                this.renderHistory();
                this.renderCalendar();
            }

            updateAll() {
                this.renderDashboard();
                this.renderHistory();
                this.renderCalendar();
            }

            renderDashboard() {
                const stats = this.dm.getStats();
                const streak = this.dm.getStreak();

                document.getElementById('total-sessions').textContent = stats.total;
                document.getElementById('total-gym-hours').textContent = stats.gymHours + 'h';
                document.getElementById('avg-shooting').textContent = stats.avgShoot + '%';
                document.getElementById('streak-display').textContent = streak + ' Jours';

                this.renderChart();
            }

            renderChart() {
                const ctx = document.getElementById('activityChart').getContext('2d');
                const activity = this.dm.getLast7DaysActivity();

                if (this.chartInstance) this.chartInstance.destroy();

                this.chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: activity.labels,
                        datasets: [{
                            label: 'Sessions',
                            data: activity.counts,
                            backgroundColor: '#ff9100',
                            borderRadius: 6,
                            barThickness: 20
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#2d313a' }, ticks: { color: '#94a3b8', stepSize: 1 } },
                            x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                        }
                    }
                });
            }

            renderHistory() {
                const list = document.getElementById('history-container');
                const sessions = this.dm.getAll().slice(0, 5); 

                list.innerHTML = '';
                if (sessions.length === 0) {
                    list.innerHTML = '<li style="text-align:center; color:var(--text-muted); padding:2rem;">Aucune s√©ance enregistr√©e</li>';
                    return;
                }

                sessions.forEach(s => {
                    const dateObj = new Date(s.date);
                    const dateStr = dateObj.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
                    
                    const tagClass = s.type === 'basket' ? 'tag-basket' : 'tag-gym';
                    const icon = s.type === 'basket' ? 'fa-basketball-ball' : 'fa-dumbbell';
                    
                    let detailsTxt = '';
                    let subDetail = '';

                    if(s.type === 'basket') {
                        detailsTxt = `${s.details.subType}`;
                        // Count drills if any
                        const drillCount = s.details.drills ? s.details.drills.length : 0;
                        subDetail = drillCount > 0 ? `${drillCount} Drills` : `Forme: ${s.details.rating}/10`;
                    } else {
                        // For Gym, show Focus and number of exercises
                        const exoCount = s.details.exercises ? s.details.exercises.length : 0;
                        detailsTxt = `${s.details.focus}`;
                        subDetail = exoCount > 0 ? `${exoCount} Exos` : '';
                    }

                    const html = `
                        <li class="history-item">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <div class="tag ${tagClass}"><i class="fas ${icon}"></i></div>
                                <div>
                                    <div style="font-weight:600;">${detailsTxt}</div>
                                    <div style="font-size:0.8rem; color:var(--text-muted);">${s.duration} min ‚Ä¢ ${dateStr}</div>
                                </div>
                            </div>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div style="font-weight:bold; color:var(--text-muted); font-size:0.9rem;">${subDetail}</div>
                                <div class="btn-delete-session" onclick="app.deleteSession(${s.id})"><i class="fas fa-times"></i></div>
                            </div>
                        </li>
                    `;
                    list.innerHTML += html;
                });
            }

            renderCalendar() {
                const grid = document.getElementById('calendar-grid');
                grid.innerHTML = '';
                const now = new Date();
                const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                const allSessions = this.dm.getAll();

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'cal-day';
                    dayEl.textContent = i;
                    
                    const checkDate = new Date(now.getFullYear(), now.getMonth(), i).toISOString().split('T')[0];
                    const sessionsThatDay = allSessions.filter(s => s.date.split('T')[0] === checkDate);

                    if (sessionsThatDay.length > 0) {
                        const hasBasket = sessionsThatDay.some(s => s.type === 'basket');
                        const dot = document.createElement('div');
                        dot.className = `dot ${hasBasket ? 'dot-basket' : 'dot-gym'}`;
                        dayEl.appendChild(dot);
                        dayEl.style.backgroundColor = '#22262e';
                    }

                    if (i === now.getDate()) {
                        dayEl.style.border = '1px solid var(--text-muted)';
                    }

                    grid.appendChild(dayEl);
                }
            }
        }

        /**
         * MAIN APPLICATION LOGIC
         */
        const app = {
            dm: new DataManager(),
            ui: null,
            tempExercises: [], // Store Gym exercises
            tempBasketDrills: [], // Store Basket Drills

            init: function() {
                this.ui = new UI(this.dm);
            },

            navigate: function(sectionId) {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                event.currentTarget.classList.add('active');
                document.querySelectorAll('section').forEach(el => el.classList.remove('active'));
                document.getElementById(sectionId).classList.add('active');
            },

            toggleForm: function(type) {
                document.getElementById('opt-basket').classList.remove('selected');
                document.getElementById('opt-gym').classList.remove('selected');
                document.getElementById(`opt-${type}`).classList.add('selected');

                if(type === 'basket') {
                    document.getElementById('form-basket').style.display = 'block';
                    document.getElementById('form-gym').style.display = 'none';
                } else {
                    document.getElementById('form-basket').style.display = 'none';
                    document.getElementById('form-gym').style.display = 'block';
                }
            },

            // --- Logic for Gym Exercises ---
            addExerciseToSession: function() {
                const name = document.getElementById('ex-name').value;
                const sets = document.getElementById('ex-sets').value;
                const reps = document.getElementById('ex-reps').value;
                const weight = document.getElementById('ex-weight').value;

                if(!name) { alert('Entre au moins un nom d\'exercice'); return; }

                const exo = { name, sets, reps, weight };
                this.tempExercises.push(exo);
                this.renderTempExercises();

                document.getElementById('ex-name').value = '';
                document.getElementById('ex-sets').value = '';
                document.getElementById('ex-reps').value = '';
                document.getElementById('ex-weight').value = '';
            },

            renderTempExercises: function() {
                const list = document.getElementById('temp-exo-list');
                list.innerHTML = '';
                this.tempExercises.forEach((ex, index) => {
                    list.innerHTML += `
                        <li class="added-exo-item">
                            <span><strong>${ex.name}</strong>: ${ex.sets}x${ex.reps} @ ${ex.weight}kg</span>
                            <span class="remove-exo" onclick="app.removeTempExo(${index})"><i class="fas fa-trash"></i></span>
                        </li>
                    `;
                });
            },

            removeTempExo: function(index) {
                this.tempExercises.splice(index, 1);
                this.renderTempExercises();
            },

            // --- Logic for Basket Drills ---
            addDrillToSession: function() {
                const name = document.getElementById('drill-name').value;
                const stat = document.getElementById('drill-stat').value;

                if(!name) { alert('Entre un nom de drill (ex: 3pts Corner)'); return; }

                const drill = { name, stat };
                this.tempBasketDrills.push(drill);
                this.renderTempDrills();

                document.getElementById('drill-name').value = '';
                document.getElementById('drill-stat').value = '';
            },

            renderTempDrills: function() {
                const list = document.getElementById('temp-drill-list');
                list.innerHTML = '';
                this.tempBasketDrills.forEach((d, index) => {
                    list.innerHTML += `
                        <li class="added-exo-item">
                            <span style="color:var(--primary)"><strong>${d.name}</strong></span>
                            <span>${d.stat} <span class="remove-exo" onclick="app.removeTempDrill(${index})"><i class="fas fa-trash"></i></span></span>
                        </li>
                    `;
                });
            },

            removeTempDrill: function(index) {
                this.tempBasketDrills.splice(index, 1);
                this.renderTempDrills();
            },

            // --- Save & Delete Logic ---
            deleteSession: function(id) {
                if(confirm("Supprimer cette s√©ance d√©finitivement ?")) {
                    this.dm.delete(id);
                    this.ui.updateAll();
                }
            },

            saveSession: function(e, type) {
                e.preventDefault();
                
                const session = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    type: type,
                    duration: type === 'basket' ? document.getElementById('basket-duration').value : document.getElementById('gym-duration').value,
                    details: {}
                };

                if (type === 'basket') {
                    session.details = {
                        subType: document.getElementById('basket-type').value,
                        rating: document.getElementById('basket-rating').value,
                        drills: [...this.tempBasketDrills] 
                    };
                } else {
                    session.details = {
                        focus: document.getElementById('gym-focus').value,
                        exercises: [...this.tempExercises] 
                    };
                }

                this.dm.save(session);
                
                // Cleanup
                e.target.reset();
                if(type === 'gym') {
                    this.tempExercises = [];
                    this.renderTempExercises();
                } else {
                    this.tempBasketDrills = [];
                    this.renderTempDrills();
                }

                alert('S√©ance enregistr√©e ! Keep pushing ! üî•');
                this.ui.updateAll();
                
                // Go to Dashboard
                document.querySelectorAll('.nav-item')[0].click(); 
            }
        };

        // Start App
        document.addEventListener('DOMContentLoaded', () => app.init());

    </script>
</body>
</html>